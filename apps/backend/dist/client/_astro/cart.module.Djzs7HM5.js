import{c as n}from"./notification.DyHDLNjw.js";import{B as l}from"./endpoints.QH1VciTq.js";import{k as s}from"./index.B9b1t7QR.js";import{a as S}from"./index.CViUNx8d.js";const p=`${l}/api/cart/orderProducts`,d="localCart",c=()=>{try{const r=localStorage.getItem(d);return r?JSON.parse(r):[]}catch(r){return console.error("Error al obtener el carrito de localStorage:",r),[]}},g=S(c()),i=r=>{localStorage.setItem(d,JSON.stringify(r)),g.set(r)},y=({productId:r,quantity:t=1,name:o,price:a})=>{const e=c(),u=e.findIndex(C=>C.productId===r);u>-1?e[u].quantity+=t:e.push({productId:r,quantity:t,name:o,price:a}),i(e),n({title:"Producto añadido",description:"El producto se agregó a tu carrito.",type:"success"})},I=({productId:r,newQuantity:t})=>{if(t<=0){m({productId:r});return}const a=c().map(e=>e.productId===r?{...e,quantity:t}:e);i(a)},m=({productId:r})=>{const o=c().filter(a=>a.productId!==r);i(o)},f=async r=>{try{return(await s.get(`${p}/${r}`,{credentials:"include"}).json()).map(o=>({...o,name:o.product_name,price:o.product_price}))}catch(t){return console.error("Error al obtener el carrito de la base de datos:",t),[]}},E=async r=>{const t=c();if(t.length!==0)try{const a=(await s.post(`${l}/api/cart/order`,{json:{date:new Date().toISOString(),status:"preparacion",payment_method_id:1,user_id:r},credentials:"include"}).json()).id;for(const e of t)await s.post(`${p}/${a}`,{json:{productId:e.productId,quantity:e.quantity},credentials:"include"});localStorage.removeItem(d),g.set([]),n({title:"Carrito sincronizado",description:"Tu carrito se ha guardado en tu cuenta.",type:"success"})}catch(o){console.error("Error al sincronizar el carrito:",o),n({title:"Error de sincronización",description:"No se pudo guardar tu carrito en la cuenta.",type:"error"})}},L={updateProductQuantityInLocalStorage:I,removeProductFromLocalStorage:m,addProductToLocalStorage:y,getCartFromLocalStorage:c,getCartFromDatabase:f,syncCartWithDatabase:E};export{L as a,g as c};
