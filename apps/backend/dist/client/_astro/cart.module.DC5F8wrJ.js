import{c as n}from"./notification.DyHDLNjw.js";import{B as u}from"./endpoints.QH1VciTq.js";import{k as s}from"./index.B9b1t7QR.js";import{a as m}from"./index.CViUNx8d.js";const l=`${u}/api/cart/orderProducts`,i="localCart",c=()=>{try{const r=localStorage.getItem(i);return r?JSON.parse(r):[]}catch(r){return console.error("Error al obtener el carrito de localStorage:",r),[]}},p=m(c()),d=r=>{localStorage.setItem(i,JSON.stringify(r)),p.set(r)},C=({productId:r,quantity:t=1})=>{const o=c(),e=o.findIndex(a=>a.productId===r);e>-1?o[e].quantity+=t:o.push({productId:r,quantity:t}),d(o),n({title:"Producto añadido",description:"El producto se agregó a tu carrito.",type:"success"})},S=({productId:r,newQuantity:t})=>{if(t<=0){g({productId:r});return}const e=c().map(a=>a.productId===r?{...a,quantity:t}:a);d(e)},g=({productId:r})=>{const o=c().filter(e=>e.productId!==r);d(o)},y=async r=>{try{return await s.get(`${l}/${r}`,{credentials:"include"}).json()}catch(t){return console.error("Error al obtener el carrito de la base de datos:",t),[]}},I=async r=>{const t=c();if(t.length!==0)try{const e=(await s.post(`${u}/api/cart/order`,{json:{date:new Date().toISOString(),status:"preparacion",payment_method_id:1,user_id:r},credentials:"include"}).json()).id;for(const a of t)await s.post(`${l}/${e}`,{json:{productId:a.productId,quantity:a.quantity},credentials:"include"});localStorage.removeItem(i),p.set([]),n({title:"Carrito sincronizado",description:"Tu carrito se ha guardado en tu cuenta.",type:"success"})}catch(o){console.error("Error al sincronizar el carrito:",o),n({title:"Error de sincronización",description:"No se pudo guardar tu carrito en la cuenta.",type:"error"})}},P={updateProductQuantityInLocalStorage:S,removeProductFromLocalStorage:g,addProductToLocalStorage:C,getCartFromLocalStorage:c,getCartFromDatabase:y,syncCartWithDatabase:I};export{P as c};
