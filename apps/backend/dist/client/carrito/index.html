<!DOCTYPE html><html lang="en" data-astro-cid-sckkx6r4> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v5.13.6"><title>Ding Dong!</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&display=swap" rel="stylesheet"><link rel="stylesheet" href="/_astro/payment-methods.DDjVlpag.css"></head> <body class="pt-16" data-astro-cid-sckkx6r4> <nav class="bg-lime-500 text-white fixed top-0 left-0 right-0 z-50"> <div class="max-w-7xl mx-auto h-16 flex items-center justify-between px-4 sm:px-6 lg:px-8"> <div class="flex items-center gap-2 h-full"> <img class="w-8 h-8" src="/_astro/logo.CgnVmbpZ.png" alt="logo"> <a class="font-medium text-xl" href="/">Ding Dong!</a> </div> <div class="hidden md:flex flex-grow justify-center px-4"> <form class="w-full max-w-lg"> <div class="flex"> <button id="dropdown-button-desktop" data-dropdown-toggle="dropdown-desktop" class="shrink-0 z-10 inline-flex items-center py-2.5 px-4 text-sm font-medium text-center text-gray-900 bg-gray-100 border border-gray-300 rounded-s-lg hover:bg-gray-200 focus:ring-1 focus:outline-none focus:ring-gray-100" type="button">
Categorías
<svg class="w-2.5 h-2.5 ms-2.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 4 4 4-4"></path> </svg> </button> <div id="dropdown-desktop" class="z-10 hidden bg-white divide-y divide-gray-100 rounded-lg shadow-sm w-44"> <ul class="py-2 text-sm text-gray-700" aria-labelledby="dropdown-button-desktop"> <li> <button type="button" class="inline-flex w-full px-4 py-2 hover:bg-gray-100">Mockups</button> </li> <li> <button type="button" class="inline-flex w-full px-4 py-2 hover:bg-gray-100">Templates</button> </li> <li> <button type="button" class="inline-flex w-full px-4 py-2 hover:bg-gray-100">Design</button> </li> <li> <button type="button" class="inline-flex w-full px-4 py-2 hover:bg-gray-100">Logos</button> </li> </ul> </div> <div class="relative w-full"> <input type="search" id="search-dropdown-desktop" class="block p-2.5 w-full z-20 text-sm text-gray-900 bg-gray-50 rounded-e-lg border-s-gray-50 border-s-2 border border-gray-300 outline-none" placeholder="Buscar productos, tiendas..." required> <button type="submit" id="search-button-desktop" class="absolute top-0 end-0 p-2.5 text-sm font-medium h-full text-white bg-lime-600 rounded-e-lg border border-none hover:bg-lime-700 focus:ring-1 focus:outline-none focus:ring-lime-800"> <svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"></path> </svg> <span class="sr-only">Búsqueda</span> </button> </div> <script type="module" src="/_astro/SearchBarDesktop.astro_astro_type_script_index_0_lang.Bc8X54Kv.js"></script> </div> </form> </div> <div class="flex items-center gap-4"> <div> <a class="md:hidden flex items-center justify-center text-white no-underline hover:text-neutral-100" href="/carrito"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="w-7 h-7" data-icon="mdi:cart-outline">   <path fill="currentColor" d="M17 18a2 2 0 0 1 2 2a2 2 0 0 1-2 2a2 2 0 0 1-2-2c0-1.11.89-2 2-2M1 2h3.27l.94 2H20a1 1 0 0 1 1 1c0 .17-.05.34-.12.5l-3.58 6.47c-.34.61-1 1.03-1.75 1.03H8.1l-.9 1.63l-.03.12a.25.25 0 0 0 .25.25H19v2H7a2 2 0 0 1-2-2c0-.35.09-.68.24-.96l1.36-2.45L3 4H1zm6 16a2 2 0 0 1 2 2a2 2 0 0 1-2 2a2 2 0 0 1-2-2c0-1.11.89-2 2-2m9-7l2.78-5H6.14l2.36 5z"/> </svg> </a> <a class="hidden md:block text-white no-underline hover:text-neutral-100" href="/carrito"><svg width="1em" height="1em" viewBox="0 0 24 24" class="w-7 h-7" data-icon="mdi:cart-outline">   <path fill="currentColor" d="M17 18a2 2 0 0 1 2 2a2 2 0 0 1-2 2a2 2 0 0 1-2-2c0-1.11.89-2 2-2M1 2h3.27l.94 2H20a1 1 0 0 1 1 1c0 .17-.05.34-.12.5l-3.58 6.47c-.34.61-1 1.03-1.75 1.03H8.1l-.9 1.63l-.03.12a.25.25 0 0 0 .25.25H19v2H7a2 2 0 0 1-2-2c0-.35.09-.68.24-.96l1.36-2.45L3 4H1zm6 16a2 2 0 0 1 2 2a2 2 0 0 1-2 2a2 2 0 0 1-2-2c0-1.11.89-2 2-2m9-7l2.78-5H6.14l2.36 5z"/> </svg></a> </div> <button class="md:hidden flex items-center justify-center p-1 rounded-md bg-white text-lime-500" aria-label="Abrir menú de navegación"> <svg class="w-8 h-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path> </svg> </button> <a class="hidden md:block text-white no-underline hover:text-neutral-100" href="/historial">Historial</a> <a href="/signup" class="hidden md:block text-lime-500 bg-white hover:bg-lime-600 hover:text-white focus:ring-lime-800 transition-all duration-200 ease-in focus:none focus:outline-none font-medium rounded-lg text-sm px-4 py-2 text-center">
Registro
</a> </div> </div> </nav> <div class="hidden md:block bg-neutral-100 py-2 shadow-sm text-neutral-700"> <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between"> <button type="button" class="inline-flex items-center rounded-full bg-white border border-gray-300 py-2 px-3 text-sm font-medium text-gray-800 hover:text-lime-500 focus:outline-none focus:none transition-colors duration-200" aria-label="Ver o cambiar dirección de entrega"> <svg class="w-5 h-5 me-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"> <path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path> <path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path> </svg> <span class="truncate">Enviar a: Caraballeda, La Guaira, Venezuela</span> <svg class="w-3 h-3 ms-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 4 4 4-4"></path> </svg> </button> <div class="flex items-center space-x-6 text-sm"> <a href="/ayuda" class="hover:text-lime-700 transition-colors duration-200">Ayuda</a> <a href="/faqs" class="hover:text-lime-700 transition-colors duration-200">FAQs</a> <a href="/contacto" class="hover:text-lime-700 transition-colors duration-200">Contacto</a> </div> </div> </div> <div class="bg-neutral-100 p-4 md:hidden"> <form class="w-full"> <div class="flex"> <button id="dropdown-button-mobile" data-dropdown-toggle="dropdown-mobile" class="shrink-0 z-10 inline-flex items-center py-2.5 px-4 text-sm font-medium text-center text-gray-900 bg-gray-100 border border-gray-300 rounded-s-lg hover:bg-gray-200 focus:ring-1 focus:outline-none focus:ring-gray-100" type="button">
Categorías
<svg class="w-2.5 h-2.5 ms-2.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 4 4 4-4"></path> </svg> </button> <div id="dropdown-mobile" class="z-10 hidden bg-white divide-y divide-gray-100 rounded-lg shadow-sm w-44"> <ul class="py-2 text-sm text-gray-700" aria-labelledby="dropdown-button-mobile"> <li> <button type="button" class="inline-flex w-full px-4 py-2 hover:bg-gray-100">Mockups</button> </li> <li> <button type="button" class="inline-flex w-full px-4 py-2 hover:bg-gray-100">Templates</button> </li> <li> <button type="button" class="inline-flex w-full px-4 py-2 hover:bg-gray-100">Design</button> </li> <li> <button type="button" class="inline-flex w-full px-4 py-2 hover:bg-gray-100">Logos</button> </li> </ul> </div> <div class="relative w-full"> <input type="search" id="search-dropdown-mobile" class="block p-2.5 w-full z-20 text-sm text-gray-900 bg-gray-50 rounded-e-lg border-s-gray-50 border-s-2 border border-gray-300 outline-none" placeholder="Buscar productos, tiendas..." required> <button type="submit" class="absolute top-0 end-0 p-2.5 text-sm font-medium h-full text-white bg-lime-600 rounded-e-lg border border-none hover:bg-lime-700 focus:ring-1 focus:outline-none focus:ring-lime-800"> <svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"></path> </svg> <span class="sr-only">Búsqueda</span> </button> </div> </div> </form> </div>  <main class="container mx-auto p-4 md:p-8 space-y-8"> <!-- <h1
      class="text-3xl font-bold text-gray-900 dark:text-white mb-6 text-center"
    >
      Tu Carrito de Compras
    </h1> --> <div id="cart-container" class="flex flex-col lg:flex-row gap-8 items-start"> <section class="flex-grow w-full space-y-4"> <div id="cart-items" class="space-y-4"> <p id="empty-cart-message" class="text-center text-gray-500 hidden">
Aún no has agregado productos a tu carrito
</p> </div> </section> <aside class="w-full lg:w-1/3 p-6 bg-gray-100 dark:bg-gray-800 rounded-lg shadow-md space-y-4 sticky top-4"> <h2 class="text-2xl font-bold text-gray-900 dark:text-white">
Resumen del Pedido
</h2> <div class="space-y-2"> <div class="flex justify-between text-gray-700 dark:text-gray-300"> <span>Subtotal:</span> <span id="subtotal-price">$0.00</span> </div> <div class="flex justify-between font-bold text-gray-900 dark:text-white"> <span>Total:</span> <span id="total-price">$0.00</span> </div> </div> <button id="checkout-button" class="w-full py-3 px-4 text-white bg-lime-600 rounded-lg hover:bg-lime-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors" disabled>
Proceder al Pago
</button> </aside> </div> <ul id="products-cart-list" class="m-0 p-2 list-none overflow-auto flex flex-col gap-8 rounded-md border border-gray-300 h-full md:w-[70%] lg:w-[50%]"> <template id="product-cart-item-template"> <div class="cart-item flex items-center justify-between gap-4 p-4 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm" data-product-id="0"> <!-- <div class="flex-shrink-0">
    <img
      src="/placeholder-image.jpg"
      alt={product.name}
      class="w-20 h-20 object-cover rounded-md"
    />
  </div> --> <div class="flex-grow min-w-0"> <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 truncate"> Jugo de Manzana </h3> <p class="text-gray-600 dark:text-gray-400">
$0.00 </p> </div> <div class="flex items-center gap-2"> <button class="decrease-quantity-btn p-1 text-gray-600 dark:text-gray-300 hover:text-red-600 transition-colors" aria-label="Disminuir cantidad"> <svg width="1em" height="1em" class="w-6 h-6" data-icon="mdi:minus-circle">   <symbol id="ai:mdi:minus-circle" viewBox="0 0 24 24"><path fill="currentColor" d="M17 13H7v-2h10m-5-9A10 10 0 0 0 2 12a10 10 0 0 0 10 10a10 10 0 0 0 10-10A10 10 0 0 0 12 2"/></symbol><use href="#ai:mdi:minus-circle"></use>  </svg> </button> <span class="quantity text-lg font-bold text-gray-900 dark:text-white w-8 text-center">0</span> <button class="increase-quantity-btn p-1 text-gray-600 dark:text-gray-300 hover:text-lime-600 transition-colors" aria-label="Aumentar cantidad"> <svg width="1em" height="1em" class="w-6 h-6" data-icon="mdi:plus-circle">   <symbol id="ai:mdi:plus-circle" viewBox="0 0 24 24"><path fill="currentColor" d="M17 13h-4v4h-2v-4H7v-2h4V7h2v4h4m-5-9A10 10 0 0 0 2 12a10 10 0 0 0 10 10a10 10 0 0 0 10-10A10 10 0 0 0 12 2"/></symbol><use href="#ai:mdi:plus-circle"></use>  </svg> </button> </div> <div class="flex-shrink-0"> <button class="remove-item-btn p-1 text-gray-600 dark:text-gray-300 hover:text-red-600 transition-colors" aria-label="Eliminar producto"> <svg width="1em" height="1em" class="w-6 h-6" data-icon="mdi:trash-can-outline">   <symbol id="ai:mdi:trash-can-outline" viewBox="0 0 24 24"><path fill="currentColor" d="M9 3v1H4v2h1v13a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V6h1V4h-5V3zM7 6h10v13H7zm2 2v9h2V8zm4 0v9h2V8z"/></symbol><use href="#ai:mdi:trash-can-outline"></use>  </svg> </button> </div> </div> </template> </ul> <script type="module" src="/_astro/CartList.astro_astro_type_script_index_0_lang.DqGIaBfk.js"></script> </main>  <script type="module" src="/_astro/Layout.astro_astro_type_script_index_0_lang.D2-JIPRR.js"></script> </body> </html>  <div id="notification" class="hidden fixed top-4 right-4 z-50 bg-white p-4 rounded shadow" data-astro-cid-sckkx6r4> <div data-astro-cid-sckkx6r4></div> <div data-astro-cid-sckkx6r4></div> </div> <!-- <script>
  // @ts-nocheck
  import { cartService } from "../features/cart/components/cart.module.js";
  import AuthModule from "../features/auth/auth.module.js";
  import CartItem from "../features/cart/components/CartItem.astro";
  import { createNotification } from "../features/notifications/notification.js";
  const cartItemsContainer = document.querySelector("#cart-items");
  const emptyCartMessage = document.querySelector("#empty-cart-message");
  const subtotalPriceElement = document.querySelector("#subtotal-price");
  const totalPriceElement = document.querySelector("#total-price");
  const checkoutButton = document.querySelector("#checkout-button");

  let products = [];
  let user = null;

  document.addEventListener("DOMContentLoaded", async () => {
    try {
      // Obtener el usuario autenticado
      user = await AuthModule.getLoggedUser();
      // Obtener lista de todos los productos
      const productsResponse = await fetch("/api/products");
      products = await productsResponse.json();
    } catch (error) {
      console.error("Error al obtener datos:", error);
    }
    // Sincronizar el carrito cuando la página se carga
    updateCartDisplay(cartService.cart.get());
  });

  cartService.cart.subscribe((cartItems) => {
    updateCartDisplay(cartItems);
  });

  // Renderizado del carrito y actualización de precio total
  const updateCartDisplay = (cartItems) => {
    cartItemsContainer.innerHTML = "";
    let subtotal = 0;

    if (cartItems.length === 0) {
      emptyCartMessage.classList.remove("hidden");
      checkoutButton.disabled = true;
    } else {
      emptyCartMessage.classList.add("hidden");
      checkoutButton.disabled = false;
      cartItems.forEach((cartItem) => {
        const product = products.find((p) => p.id === cartItem.productId);
        if (product) {
          const cartItemComponent = CartItem.render({
            product: product,
            quantity: cartItem.quantity,
          });
          cartItemsContainer.appendChild(cartItemComponent);
          subtotal += product.price * cartItem.quantity;
        }
      });
    }

    subtotalPriceElement.textContent = `$${subtotal.toFixed(2)}`;
    totalPriceElement.textContent = `$${subtotal.toFixed(2)}`;
  };

  // Botones de aumentar, disminuir y eliminar productos
  cartItemsContainer.addEventListener("click", (event) => {
    const target = event.target.closest("button");
    if (!target) return;

    const cartItemDiv = target.closest(".cart-item");
    if (!cartItemDiv) return;

    const productId = Number(cartItemDiv.dataset.productId);

    if (target.classList.contains("increase-quantity-btn")) {
      cartService.updateProductQuantityInLocalStorage({
        productId,
        newQuantity:
          Number(cartItemDiv.querySelector(".quantity").textContent) + 1,
      });
    } else if (target.classList.contains("decrease-quantity-btn")) {
      cartService.updateProductQuantityInLocalStorage({
        productId,
        newQuantity:
          Number(cartItemDiv.querySelector(".quantity").textContent) - 1,
      });
    } else if (target.classList.contains("remove-item-btn")) {
      cartService.removeProductFromLocalStorage({ productId });
    }
  });

  // Boton "Proceder al Pago"
  checkoutButton.addEventListener("click", async () => {
    if (!user) {
      createNotification({
        title: "Inicia sesión para continuar",
        description: "Necesitas estar logueado para finalizar tu compra.",
        type: "error",
      });
      return;
    }

    try {
      await cartService.synchronizeCartWithDb(user.id);
      createNotification({
        title: "¡Compra realizada!",
        description: "Tu pedido ha sido procesado con éxito.",
        type: "success",
      });
    } catch (error) {
      console.error("Error al procesar el pago:", error);
      createNotification({
        title: "Error en el pago",
        description:
          "Hubo un problema al procesar tu pedido. Intenta de nuevo.",
        type: "error",
      });
    }
  });
</script> --> <!-- <script>
  // @ts-nocheck
  import CartModule from "../features/cart/components/cart.module.js";

  const equis = await CartModule.getCartFromLocalStorage();
  console.log("equis", equis);
</script> -->